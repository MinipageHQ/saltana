(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1873:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var tslib__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),pro_gallery_lib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(562),pro_gallery_lib__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(100),pro_gallery_lib__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(73),_scrollHelper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(553),VIDEO_EVENTS={SCROLL:"SCROLL",CLICKED:"CLICKED",HOVERED:"HOVERED",ENDED:"ENDED",INIT_SCROLL:"INIT_SCROLL"},VideoScrollHelper=function(){function VideoScrollHelper(config){var _this=this;this.scrollBase=0,this.videoItems=[],this.currentPlayingIdx=-1,this.currentItemCount=0,this.playing=!1,this.updateGalleryStructure=this.updateGalleryStructure.bind(this),this.initializePlayState=this.initializePlayState.bind(this),this.onScroll=this.onScroll.bind(this),this.handleEvent=this.handleEvent.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.isVisible=this.isVisible.bind(this),this.videoPlay=void 0,this.itemClick=void 0,this.setPlayingVideos=config.setPlayingVideos,this.lastVideoPlayed=-1,this.videoRatingMap=new Map,this.trigger=Object.assign.apply(Object,Object(tslib__WEBPACK_IMPORTED_MODULE_0__.h)([{}],Object.keys(VIDEO_EVENTS).map((function(key){var _a;return(_a={})[key]=function(args){return _this.handleEvent({eventName:key,eventData:args})},_a}))))}return VideoScrollHelper.prototype.updateGalleryStructure=function(_a){var _this=this,galleryStructure=_a.galleryStructure,scrollBase=_a.scrollBase,videoPlay=_a.videoPlay,videoLoop=_a.videoLoop,itemClick=_a.itemClick,oneRow=_a.oneRow;this.galleryWidth=pro_gallery_lib__WEBPACK_IMPORTED_MODULE_1__.a.getGalleryDimensions().galleryWidth,this.scrollBase=scrollBase,this.videoPlay=videoPlay,this.videoLoop=videoLoop,this.itemClick=itemClick,this.oneRow=oneRow,this.currentItemCount=galleryStructure.galleryItems.length,this.videoItems=[],galleryStructure.galleryItems.forEach((function(item){("video"===item.type||"image"===item.type&&(item.id.includes("_placeholder")||item.isVideoPlaceholder))&&(_this.videoRatingMap.has(item.id)||_this.videoRatingMap.set(item.id,item.idx),_this.videoItems.push(item))}))},VideoScrollHelper.prototype.handleEvent=function(_a){var eventName=_a.eventName,eventData=_a.eventData;switch(eventName){case VIDEO_EVENTS.SCROLL:this.onScroll(eventData);break;case pro_gallery_lib__WEBPACK_IMPORTED_MODULE_2__.a.events.ITEM_ACTION_TRIGGERED:this.itemClicked(eventData.idx);break;case pro_gallery_lib__WEBPACK_IMPORTED_MODULE_2__.a.events.HOVER_SET:this.itemHovered(eventData);break;case pro_gallery_lib__WEBPACK_IMPORTED_MODULE_2__.a.events.VIDEO_ENDED:this.videoEnded(eventData.idx);break;case pro_gallery_lib__WEBPACK_IMPORTED_MODULE_2__.a.events.VIDEO_PLAYED:this.videoPlayed(eventData.idx);break;case pro_gallery_lib__WEBPACK_IMPORTED_MODULE_2__.a.events.VIDEO_ERROR:this.videoErrorReported()}},VideoScrollHelper.prototype.itemHovered=function(idx){"hover"===this.videoPlay&&this.IdxExistsInVideoItems(idx)&&this.play(idx)},VideoScrollHelper.prototype.itemClicked=function(idx){"onClick"===this.videoPlay&&this.IdxExistsInVideoItems(idx)&&(this.currentPlayingIdx===idx?this.stop():this.play(idx))},VideoScrollHelper.prototype.onScroll=function(_a){var _this=this,top=_a.top,left=_a.left;this.top=top>=0?top:this.top,this.left=left>=0?left:this.left,-1===this.currentPlayingIdx||this.isCurrentVideoStillVisible({top:this.top,left:this.left})||this.stop(this.videoItems.findIndex((function(item){return item.idx===_this.currentPlayingIdx}))),this.autoPlayNextVideoByRating({top:this.top,left:this.left})},VideoScrollHelper.prototype.videoEnded=function(idx){var indexInVideoItems=this.videoItems.findIndex((function(item){return item.idx===idx}));this.stop(indexInVideoItems);var scroll={top:this.top,left:this.left};this.autoPlayNextVideoByRating(scroll)},VideoScrollHelper.prototype.videoPlayed=function(idx){this.lastVideoPlayed=idx},VideoScrollHelper.prototype.videoErrorReported=function(){this.stop()},VideoScrollHelper.prototype.initializePlayState=function(){this.autoPlayNextVideoByRating({top:this.top,left:this.left})},VideoScrollHelper.prototype.autoPlayNextVideoByRating=function(_a){var _this=this,top=_a.top,left=_a.left;if(this.shouldAutoPlay()){var secondBestRating={idx:-1,rating:1/0},bestRating={idx:-1,rating:1/0};if(this.videoItems.some((function(item){if(_this.isVisible(item,{top:top,left:left})){var itemRating=_this.videoRatingMap.get(item.id);return itemRating<=bestRating.rating?(secondBestRating.idx=bestRating.idx,secondBestRating.rating=bestRating.rating,bestRating.idx=item.idx,bestRating.rating=itemRating):itemRating<=secondBestRating.rating&&(secondBestRating.idx=item.idx,secondBestRating.rating=itemRating),!1}return bestRating.idx>=0})),bestRating.idx>=0)if(this.allowedLoop()||bestRating.idx!==this.lastVideoPlayed)this.play(bestRating.idx);else{if(!(secondBestRating.idx>=0))return;this.play(secondBestRating.idx)}else this.lastVideoPlayed=-2}},VideoScrollHelper.prototype.calculateCurrentItemPlacement=function(){var _this=this;return this.videoItems.findIndex((function(item){return item.idx===_this.currentPlayingIdx}))},VideoScrollHelper.prototype.play=function(idx){this.setPlayingIdx(idx),this.playing=!0},VideoScrollHelper.prototype.stop=function(indexInVideoItems){if(indexInVideoItems>=0){var newRating=this.videoRatingMap.get(this.videoItems[indexInVideoItems].id)+this.currentItemCount;this.videoRatingMap.set(this.videoItems[indexInVideoItems].id,newRating)}this.setPlayingIdx(-1),this.playing=!1},VideoScrollHelper.prototype.onPlayingIdxChange=function(){this.setPlayingVideos(this.currentPlayingIdx)},VideoScrollHelper.prototype.setPlayingIdx=function(idx){this.currentPlayingIdx!==idx&&(this.currentPlayingIdx=idx,this.onPlayingIdxChange())},VideoScrollHelper.prototype.isCurrentVideoStillVisible=function(_a){var top=_a.top,left=_a.left,currentItemPlacement=this.calculateCurrentItemPlacement();return this.isVisible(this.videoItems[currentItemPlacement],{top:top,left:left})},VideoScrollHelper.prototype.isVisible=function(item,_a){var visibleHorizontally,top=_a.top,left=_a.left,target={offsetTop:this.scrollBase||0,scrollY:top,scrollLeft:left},videoPlayVerticalTolerance=(item.offset.top-item.offset.bottom)/2,videoPlayHorizontalTolerance=(item.offset.left-item.offset.right)/2,visibleVertically=Object(_scrollHelper__WEBPACK_IMPORTED_MODULE_4__.b)({target:target,scrollBase:this.scrollBase,top:item.offset.top,bottom:item.offset.top+item.style.height,screenHeight:pro_gallery_lib__WEBPACK_IMPORTED_MODULE_3__.a&&pro_gallery_lib__WEBPACK_IMPORTED_MODULE_3__.a.innerHeight,padding:videoPlayVerticalTolerance});return visibleHorizontally=!this.oneRow||Object(_scrollHelper__WEBPACK_IMPORTED_MODULE_4__.a)({target:target,left:item.offset.left,right:item.offset.left+item.style.width,screenWidth:this.galleryWidth||pro_gallery_lib__WEBPACK_IMPORTED_MODULE_3__.a&&pro_gallery_lib__WEBPACK_IMPORTED_MODULE_3__.a.innerWidth,padding:videoPlayHorizontalTolerance}),visibleVertically&&visibleHorizontally},VideoScrollHelper.prototype.shouldAutoPlay=function(){return"auto"===this.videoPlay},VideoScrollHelper.prototype.allowedLoop=function(){return!0===this.videoLoop},VideoScrollHelper.prototype.IdxExistsInVideoItems=function(idx){return this.videoItems.some((function(item){return item.idx===idx}))},VideoScrollHelper}();__webpack_exports__.default=VideoScrollHelper}}]);